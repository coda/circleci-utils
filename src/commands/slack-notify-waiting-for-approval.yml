description: |
  Notifies the current workflow owner that their workflow is pending approval to proceed.
parameters:
  email_domain:
    description: |
      Optional email domain for users within the workspace.   Must be specified if user aliases are not fully qualified.
    type: string
    default: coda.io
  slack_bot_token:
    type: string
    description: |
      Token used by Slack bot application.   Must have scopes `users:read`, `users:read.email`, and `chat:write`.
    default: ${SLACK_BOT_TOKEN}
  slack_message:
    default: "Pending Approval for ${CIRCLE_PROJECT_REPONAME} ${CIRCLE_USERNAME}"
    description: Slack Message to send
    type: string
steps:
- run:
    name: Set variables
    command: |
      echo "export EMAIL_DOMAIN=<<parameters.email_domain>>" >> "$BASH_ENV"
- run:
    name: Fetch User Information from Look Up Table
    command: <<include(scripts/fetch_user_handles.sh)>>
- slack/notify:
    channel: $SLACK_USER_ID
    event: pass
    custom: <<include(message_templates/slack_on_hold.json)>>
- slack/notify:
    channel: $SLACK_USER_ID
    event: fail
    custom: <<include(message_templates/slack_failure.json)>>
